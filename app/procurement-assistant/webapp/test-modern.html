<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern UI Test - AI Procurement Assistant</title>
    
    <!-- UI5 Bootstrap -->
    <script
        id="sap-ui-bootstrap"
        src="https://ui5.sap.com/resources/sap-ui-core.js"
        data-sap-ui-theme="sap_horizon"
        data-sap-ui-libs="sap.m,sap.f,sap.ui.core,sap.ui.comp,sap.ui.table,sap.ui.integration,sap.uxap"
        data-sap-ui-compatVersion="edge"
        data-sap-ui-async="true"
        data-sap-ui-frameOptions="trusted"
        data-sap-ui-resourceroots='{
            "procurement.assistant": "./"
        }'>
    </script>
    
    <style>
        body {
            font-family: "72", Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>

<body>
    <div class="test-container">
        <h1>üß™ Modern UI Test Results</h1>
        <div id="testResults"></div>
        <div id="content"></div>
    </div>
    
    <script>
        function addTestResult(message, type = 'info') {
            const container = document.getElementById('testResults');
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            container.appendChild(div);
        }
        
        // Test 1: UI5 Core Loading
        sap.ui.getCore().attachInit(function() {
            addTestResult('‚úÖ UI5 Core loaded successfully', 'success');
            
            try {
                // Test 2: Modern Libraries
                const libs = ['sap.m', 'sap.f', 'sap.ui.table', 'sap.ui.integration'];
                libs.forEach(lib => {
                    if (sap.ui.getCore().getLoadedLibraries()[lib]) {
                        addTestResult(`‚úÖ Library ${lib} loaded successfully`, 'success');
                    } else {
                        addTestResult(`‚ùå Library ${lib} failed to load`, 'error');
                    }
                });
                
                // Test 3: Create Modern Controls
                const dynamicPage = new sap.f.DynamicPage({
                    title: new sap.f.DynamicPageTitle({
                        heading: new sap.m.Title({text: "Test Dynamic Page"})
                    }),
                    content: new sap.m.Text({text: "Modern UI5 controls are working!"})
                });
                
                dynamicPage.placeAt("content");
                addTestResult('‚úÖ Modern UI5 controls created successfully', 'success');
                
                // Test 4: Backend API Test
                fetch('/odata/v4/procurement/Materials')
                    .then(response => {
                        if (response.ok) {
                            addTestResult('‚úÖ Backend API accessible', 'success');
                            return response.json();
                        } else {
                            throw new Error('API response not OK');
                        }
                    })
                    .then(data => {
                        addTestResult(`‚úÖ Materials data loaded: ${data.value.length} items`, 'success');
                    })
                    .catch(error => {
                        addTestResult(`‚ùå Backend API error: ${error.message}`, 'error');
                    });
                
                // Test 5: Chat API Test
                fetch('/odata/v4/procurement/initChatSession', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.sessionId) {
                            addTestResult('‚úÖ Chat API working', 'success');
                        } else {
                            addTestResult('‚ùå Chat API not responding correctly', 'error');
                        }
                    })
                    .catch(error => {
                        addTestResult(`‚ùå Chat API error: ${error.message}`, 'error');
                    });
                
                // Test 6: Modern View Loading Test
                try {
                    sap.ui.xmlview({
                        viewName: "procurement.assistant.view.ModernMain"
                    }).then(function(view) {
                        addTestResult('‚úÖ Modern view loaded successfully', 'success');
                    }).catch(function(error) {
                        addTestResult(`‚ùå Modern view loading error: ${error.message}`, 'error');
                    });
                } catch (error) {
                    addTestResult(`‚ùå Modern view test error: ${error.message}`, 'error');
                }
                
            } catch (error) {
                addTestResult(`‚ùå Test execution error: ${error.message}`, 'error');
            }
        });
        
        // Global error handler
        window.addEventListener('error', function(e) {
            addTestResult(`‚ùå JavaScript error: ${e.error.message}`, 'error');
        });
    </script>
</body>
</html>
