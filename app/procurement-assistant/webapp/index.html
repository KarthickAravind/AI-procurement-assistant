<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Procurement Assistant</title>
    <script
        id="sap-ui-bootstrap"
        src="https://ui5.sap.com/resources/sap-ui-core.js"
        data-sap-ui-theme="sap_horizon"
        data-sap-ui-libs="sap.m,sap.f"
        data-sap-ui-compatVersion="edge"
        data-sap-ui-async="true">
    </script>
    <link rel="stylesheet" type="text/css" href="css/style.css">
</head>
<body class="sapUiBody">
    <div id="content"></div>
    
    <script>
        sap.ui.getCore().attachInit(function() {
            console.log("UI5 Core initialized successfully");
            
            var oApp; // Declare app variable
            
            // Create Welcome Page
            var oWelcomePage = new sap.m.Page({
                id: "welcomePage",
                title: "AI-Powered Procurement Assistant",
                showNavButton: false,
                content: [
                    new sap.m.VBox({
                        alignItems: "Center",
                        justifyContent: "Center",
                        class: "welcomeContainer",
                        items: [
                            new sap.m.Title({
                                text: "AI-Powered Procurement Assistant",
                                class: "welcomeTitle sapUiMediumMarginBottom"
                            }),
                            new sap.m.Text({
                                text: "I'm here to help",
                                class: "welcomeSubtitle sapUiMediumMarginBottom"
                            }),
                            new sap.m.Text({
                                text: "Your intelligent assistant for procurement and warehouse management",
                                class: "welcomeDescription sapUiLargeMarginBottom"
                            }),
                            new sap.m.Button({
                                text: "Get Started",
                                type: "Emphasized",
                                icon: "sap-icon://forward",
                                class: "sapUiLargeMarginTop",
                                press: function() {
                                    console.log("Get Started button pressed");
                                    oApp.to("mainPage");
                                }
                            })
                        ]
                    })
                ]
            });
            
            // Create Main Page
            var oMainPage = new sap.m.Page({
                id: "mainPage",
                title: "Procurement Assistant",
                showNavButton: true,
                navButtonPress: function() {
                    console.log("Back button pressed");
                    oApp.back();
                },
                content: [
                    new sap.m.SplitContainer({
                        height: "700px",
                        masterPages: [
                            new sap.m.Page({
                                title: "AI Chat Assistant",
                                content: [
                                    new sap.m.VBox({
                                        height: "100%",
                                        class: "sapUiMediumMargin",
                                        items: [
                                            // Quick Action Buttons
                                            new sap.m.Panel({
                                                headerText: "Quick Actions",
                                                class: "sapUiMediumMarginBottom",
                                                content: [
                                                    new sap.m.HBox({
                                                        wrap: "Wrap",
                                                        class: "sapUiSmallMargin",
                                                        items: [
                                                            new sap.m.Button({
                                                                text: "Create PO",
                                                                icon: "sap-icon://create-form",
                                                                type: "Emphasized",
                                                                class: "sapUiTinyMargin",
                                                                press: function() {
                                                                    addChatMessage("I'll help you create a Purchase Order. What materials do you need?", "assistant");
                                                                    sap.m.MessageToast.show("PO creation workflow started!");
                                                                }
                                                            }),
                                                            new sap.m.Button({
                                                                text: "Send RFQ",
                                                                icon: "sap-icon://email",
                                                                type: "Emphasized",
                                                                class: "sapUiTinyMargin",
                                                                press: function() {
                                                                    addChatMessage("I'll help you send a Request for Quotation. Which suppliers should I contact?", "assistant");
                                                                    sap.m.MessageToast.show("RFQ workflow started!");
                                                                }
                                                            }),
                                                            new sap.m.Button({
                                                                text: "Find Suppliers",
                                                                icon: "sap-icon://supplier",
                                                                type: "Default",
                                                                class: "sapUiTinyMargin",
                                                                press: function() {
                                                                    addChatMessage("I'll help you find the best suppliers. What type of materials are you looking for?", "assistant");
                                                                }
                                                            }),
                                                            new sap.m.Button({
                                                                text: "Check Inventory",
                                                                icon: "sap-icon://inventory",
                                                                type: "Default",
                                                                class: "sapUiTinyMargin",
                                                                press: function() {
                                                                    addChatMessage("Here's your current inventory status. Which materials would you like to check?", "assistant");
                                                                }
                                                            })
                                                        ]
                                                    })
                                                ]
                                            }),
                                            // Chat Messages Area
                                            new sap.m.ScrollContainer({
                                                id: "chatScrollContainer",
                                                height: "450px",
                                                vertical: true,
                                                class: "sapUiMediumMarginBottom",
                                                content: [
                                                    new sap.m.VBox({
                                                        id: "chatMessagesContainer",
                                                        items: [
                                                            new sap.m.MessageStrip({
                                                                text: "üëã Hello! I'm your AI procurement assistant. I can help you with suppliers, materials, pricing, and procurement processes.",
                                                                type: "Information",
                                                                class: "sapUiMediumMarginBottom"
                                                            }),
                                                            new sap.m.MessageStrip({
                                                                text: "üí° Try the quick action buttons above or ask me anything!",
                                                                type: "Success",
                                                                class: "sapUiMediumMarginBottom"
                                                            })
                                                        ]
                                                    })
                                                ]
                                            }),
                                            // Chat Input Area
                                            new sap.m.VBox({
                                                items: [
                                                    new sap.m.HBox({
                                                        width: "100%",
                                                        items: [
                                                            new sap.m.Input({
                                                                id: "chatInput",
                                                                placeholder: "Type your message here... (e.g., 'Find laptops under ‚Çπ50K')",
                                                                width: "100%",
                                                                submit: function() {
                                                                    sendChatMessage();
                                                                }
                                                            }),
                                                            new sap.m.Button({
                                                                text: "Send",
                                                                type: "Emphasized",
                                                                icon: "sap-icon://paper-plane",
                                                                class: "sapUiTinyMarginBegin",
                                                                press: function() {
                                                                    sendChatMessage();
                                                                }
                                                            })
                                                        ]
                                                    }),
                                                    // Suggested Questions
                                                    new sap.m.Panel({
                                                        headerText: "üí¨ Suggested Questions",
                                                        expandable: true,
                                                        expanded: false,
                                                        class: "sapUiSmallMarginTop",
                                                        content: [
                                                            new sap.m.VBox({
                                                                class: "sapUiSmallMargin",
                                                                items: [
                                                                    new sap.m.Link({
                                                                        text: "‚Ä¢ What suppliers can deliver laptops under ‚Çπ50K within 10 days?",
                                                                        press: function() {
                                                                            fillChatInput("What suppliers can deliver laptops under ‚Çπ50K within 10 days?");
                                                                        }
                                                                    }),
                                                                    new sap.m.Link({
                                                                        text: "‚Ä¢ Draft a purchase order for 500 units of office chairs",
                                                                        press: function() {
                                                                            fillChatInput("Draft a purchase order for 500 units of office chairs");
                                                                        }
                                                                    }),
                                                                    new sap.m.Link({
                                                                        text: "‚Ä¢ Are there any compliance issues with supplier contracts?",
                                                                        press: function() {
                                                                            fillChatInput("Are there any compliance issues with supplier contracts?");
                                                                        }
                                                                    }),
                                                                    new sap.m.Link({
                                                                        text: "‚Ä¢ Show me the top 3 suppliers with best ratings",
                                                                        press: function() {
                                                                            fillChatInput("Show me the top 3 suppliers with best ratings");
                                                                        }
                                                                    })
                                                                ]
                                                            })
                                                        ]
                                                    })
                                                ]
                                            })
                                        ]
                                    })
                                ]
                            })
                        ],
                        detailPages: [
                            new sap.m.Page({
                                title: "Warehouse Management",
                                content: [
                                    new sap.m.VBox({
                                        class: "sapUiMediumMargin",
                                        items: [
                                            // Action Buttons
                                            new sap.m.Panel({
                                                headerText: "Warehouse Actions",
                                                class: "sapUiMediumMarginBottom",
                                                content: [
                                                    new sap.m.HBox({
                                                        wrap: "Wrap",
                                                        class: "sapUiSmallMargin",
                                                        items: [
                                                            new sap.m.Button({
                                                                text: "Add Material",
                                                                type: "Emphasized",
                                                                icon: "sap-icon://add",
                                                                class: "sapUiTinyMargin",
                                                                press: function() {
                                                                    sap.m.MessageToast.show("Add Material functionality will be implemented in Phase 3");
                                                                }
                                                            }),
                                                            new sap.m.Button({
                                                                text: "Import CSV",
                                                                icon: "sap-icon://upload",
                                                                class: "sapUiTinyMargin",
                                                                press: function() {
                                                                    sap.m.MessageToast.show("CSV import functionality coming in Phase 3");
                                                                }
                                                            }),
                                                            new sap.m.Button({
                                                                text: "Export Data",
                                                                icon: "sap-icon://download",
                                                                class: "sapUiTinyMargin",
                                                                press: function() {
                                                                    sap.m.MessageToast.show("Export functionality coming in Phase 3");
                                                                }
                                                            }),
                                                            new sap.m.Button({
                                                                text: "Refresh",
                                                                icon: "sap-icon://refresh",
                                                                class: "sapUiTinyMargin",
                                                                press: function() {
                                                                    sap.m.MessageToast.show("Materials refreshed!");
                                                                }
                                                            })
                                                        ]
                                                    })
                                                ]
                                            }),
                                            // Search Bar
                                            new sap.m.SearchField({
                                                placeholder: "Search materials...",
                                                width: "100%",
                                                class: "sapUiMediumMarginBottom",
                                                search: function() {
                                                    sap.m.MessageToast.show("Search functionality will be implemented in Phase 3");
                                                }
                                            }),
                                            // Materials Table
                                            new sap.m.Table({
                                                headerToolbar: new sap.m.Toolbar({
                                                    content: [
                                                        new sap.m.Title({
                                                            text: "Materials Inventory",
                                                            level: "H4"
                                                        }),
                                                        new sap.m.ToolbarSpacer(),
                                                        new sap.m.Text({
                                                            text: "Total: 3 items"
                                                        })
                                                    ]
                                                }),
                                                columns: [
                                                    new sap.m.Column({
                                                        header: new sap.m.Text({text: "Material ID"})
                                                    }),
                                                    new sap.m.Column({
                                                        header: new sap.m.Text({text: "Name"})
                                                    }),
                                                    new sap.m.Column({
                                                        header: new sap.m.Text({text: "Category"})
                                                    }),
                                                    new sap.m.Column({
                                                        header: new sap.m.Text({text: "Quantity"})
                                                    }),
                                                    new sap.m.Column({
                                                        header: new sap.m.Text({text: "Unit Price"})
                                                    })
                                                ],
                                                items: [
                                                    new sap.m.ColumnListItem({
                                                        press: function() {
                                                            sap.m.MessageToast.show("Selected: Office Laptop - Click to view details");
                                                        },
                                                        cells: [
                                                            new sap.m.Text({text: "MAT001"}),
                                                            new sap.m.Text({text: "Office Laptop"}),
                                                            new sap.m.Text({text: "Electronics"}),
                                                            new sap.m.Text({text: "25 pcs"}),
                                                            new sap.m.Text({text: "‚Çπ45,000"})
                                                        ]
                                                    }),
                                                    new sap.m.ColumnListItem({
                                                        press: function() {
                                                            sap.m.MessageToast.show("Selected: Office Chair - Click to view details");
                                                        },
                                                        cells: [
                                                            new sap.m.Text({text: "MAT002"}),
                                                            new sap.m.Text({text: "Office Chair"}),
                                                            new sap.m.Text({text: "Furniture"}),
                                                            new sap.m.Text({text: "50 pcs"}),
                                                            new sap.m.Text({text: "‚Çπ8,500"})
                                                        ]
                                                    }),
                                                    new sap.m.ColumnListItem({
                                                        press: function() {
                                                            sap.m.MessageToast.show("Selected: Printer Paper - Click to view details");
                                                        },
                                                        cells: [
                                                            new sap.m.Text({text: "MAT003"}),
                                                            new sap.m.Text({text: "Printer Paper"}),
                                                            new sap.m.Text({text: "Stationery"}),
                                                            new sap.m.Text({text: "200 reams"}),
                                                            new sap.m.Text({text: "‚Çπ350"})
                                                        ]
                                                    })
                                                ]
                                            })
                                        ]
                                    })
                                ]
                            })
                        ]
                    })
                ]
            });
            
            // Create app
            oApp = new sap.m.App({
                pages: [oWelcomePage, oMainPage]
            });
            
            // Place app in DOM
            oApp.placeAt("content");

            console.log("App created and placed in DOM successfully");

            // Chat functionality
            window.sendChatMessage = function() {
                var oInput = sap.ui.getCore().byId("chatInput");
                var sMessage = oInput.getValue().trim();

                if (!sMessage) {
                    sap.m.MessageToast.show("Please enter a message");
                    return;
                }

                // Add user message
                addChatMessage(sMessage, "user");

                // Clear input
                oInput.setValue("");

                // Simulate AI response
                setTimeout(function() {
                    var response = generateSmartResponse(sMessage);
                    addChatMessage(response, "assistant");
                }, 1000);
            };

            window.fillChatInput = function(text) {
                var oInput = sap.ui.getCore().byId("chatInput");
                oInput.setValue(text);
                oInput.focus();
            };

            window.addChatMessage = function(message, type) {
                var oContainer = sap.ui.getCore().byId("chatMessagesContainer");
                var messageType = type === "user" ? "Success" : "Information";
                var messageIcon = type === "user" ? "üë§ You: " : "ü§ñ Assistant: ";

                var oMessage = new sap.m.MessageStrip({
                    text: messageIcon + message,
                    type: messageType,
                    class: "sapUiMediumMarginBottom"
                });

                oContainer.addItem(oMessage);

                // Scroll to bottom
                setTimeout(function() {
                    var oScrollContainer = sap.ui.getCore().byId("chatScrollContainer");
                    if (oScrollContainer) {
                        oScrollContainer.scrollToElement(oMessage);
                    }
                }, 100);
            };

            window.generateSmartResponse = function(userMessage) {
                var message = userMessage.toLowerCase();

                if (message.includes("laptop") || message.includes("computer")) {
                    return "I found 3 suppliers for laptops:\n‚Ä¢ TechCorp India - ‚Çπ42,000/unit, 7 days delivery\n‚Ä¢ Digital Solutions - ‚Çπ48,500/unit, 5 days delivery\n‚Ä¢ CompuWorld - ‚Çπ45,200/unit, 10 days delivery\n\nWould you like me to create a PO or send RFQ?";
                } else if (message.includes("chair") || message.includes("furniture")) {
                    return "For office chairs, I recommend:\n‚Ä¢ Furniture Plus - ‚Çπ8,200/unit, 12 days delivery\n‚Ä¢ Office Comfort - ‚Çπ7,800/unit, 15 days delivery\n‚Ä¢ Ergo Solutions - ‚Çπ9,500/unit, 8 days delivery\n\nShall I draft a purchase order?";
                } else if (message.includes("supplier") || message.includes("vendor")) {
                    return "Here are our top-rated suppliers:\nüèÜ TechCorp India (4.8/5) - Electronics\nüèÜ Furniture Plus (4.6/5) - Office Furniture\nüèÜ Stationery World (4.7/5) - Office Supplies\n\nWhich category interests you?";
                } else if (message.includes("po") || message.includes("purchase order")) {
                    return "I'll help you create a Purchase Order! Please provide:\n‚Ä¢ Material/Product needed\n‚Ä¢ Quantity required\n‚Ä¢ Preferred supplier\n‚Ä¢ Delivery timeline\n\nOr use the 'Create PO' quick action button above.";
                } else if (message.includes("rfq") || message.includes("quotation")) {
                    return "I'll help you send an RFQ! I need:\n‚Ä¢ Product specifications\n‚Ä¢ Required quantity\n‚Ä¢ Delivery location\n‚Ä¢ Timeline requirements\n\nShall I prepare the RFQ template?";
                } else {
                    return "I understand you're asking about: '" + userMessage + "'. I can help with:\n‚Ä¢ Finding suppliers and pricing\n‚Ä¢ Creating purchase orders\n‚Ä¢ Sending RFQs\n‚Ä¢ Checking inventory\n‚Ä¢ Compliance verification\n\nTry using the quick action buttons above or ask me something specific!";
                }
            };
        });
    </script>
</body>
</html>
